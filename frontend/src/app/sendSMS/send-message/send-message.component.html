<div class="min-h-screen flex flex-col items-center bg-gray-100 p-6 mt-16">
  <div class="w-full max-w-5xl bg-white shadow-lg rounded-lg p-8 mx-auto">

    <!-- Header -->
    <div class="sticky top-0 bg-white p-2 z-50">
      <div class="flex justify-between items-center border-b pb-2">
        <h2 class="text-xl font-semibold text-gray-800">üì§ Envoi Message</h2>
      </div>    
    </div>
    
    <!-- Form -->
    <div class="mt-4">
      <button 
        type="button"
        (click)="openGeneratorModal()"
        class="ai-button">
        G√©n√©rer un SMS avec l'IA
      </button>
      <form [formGroup]="smsForm" (ngSubmit)="sendSMS()" class="space-y-4">

        <div>
          <label for="contactSearch" class="block text-sm font-medium text-gray-700">Rechercher un contact</label>
          <div class="relative">
            <input 
              id="contactSearch"
              type="text"
              formControlName="contactSearch"
              (input)="filterContacts()"
              class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-orange-500 focus:ring-orange-500"
              placeholder="Tapez le nom du contact..." />
            
            <div *ngIf="filteredContacts.length > 0 && showDropdown" class="absolute z-10 mt-1 w-full bg-white shadow-lg max-h-60 rounded-md py-1 text-base overflow-auto focus:outline-none sm:text-sm">
              <div 
                *ngFor="let contact of filteredContacts" 
                class="cursor-pointer hover:bg-gray-100 px-4 py-2"
                (click)="selectContact(contact)">
                {{ contact.nom }} - {{ contact.prenom }} - 
                {{ contact.telephone_professionnel || 'T√©l. Pro: Non disponible' }}
                {{ !contact.telephone_professionnel && contact.telephone_personnel ? ' (T√©l. Perso disponible)' : '' }}
              </div>
            </div>
          </div>
        </div>

        <div *ngIf="selectedContactPhone" class="bg-gray-50 p-3 rounded-md mt-2">
          <p class="text-sm text-gray-700">Contact s√©lectionn√©: <span class="font-medium">{{ selectedContactName }} {{ selectedContactPrenom }}</span></p>
          <p class="text-sm text-gray-700">
            Num√©ro de destination: <span class="font-medium">{{ selectedContactPhone }}</span>
            <span class="text-xs text-gray-500 ml-1">({{ selectedPhoneType === 'professional' ? 'Professionnel' : 'Personnel' }})</span>
          </p>
        </div>

        <div>
          <label for="textDecoded" class="block text-sm font-medium text-gray-700">Message</label>
          <textarea
            id="textDecoded"
            formControlName="textDecoded"
            rows="4"
            class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-orange-500 focus:ring-orange-500"
            placeholder="√âcrivez votre message ici..."></textarea>
          <div *ngIf="smsForm.get('textDecoded')?.invalid && smsForm.get('textDecoded')?.touched" class="text-red-600 text-sm">
            Ce champ est requis.
          </div>
        </div>

        <div class="flex justify-end">
          <button 
            type="submit"
            [disabled]="sending" 
            class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-orange-600 hover:bg-orange-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500 disabled:opacity-50">
            {{ sending ? 'Envoi en cours...' : 'Envoyer' }}
          </button>
        </div>

        <div *ngIf="responseMessage" class="text-center mt-2 text-green-600 text-sm font-medium">
          {{ responseMessage }}
        </div>

      </form>
      
    </div>

  </div>
</div>
<app-sms-generator></app-sms-generator>